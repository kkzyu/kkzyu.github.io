import{r as f,c as G,b as l,a as v,u,x as p,y as U,v as w,z as L,A as J,o as B}from"./index-BnOss31M.js";import{al as K,s as x,aw as Q,X as _}from"./index-JiszUzRz.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const te={id:"controls"},oe={__name:"WordCloud",setup(le){const S=f(null),A=()=>{const o={rawText:"",words:[],isLoading:!1,width:f(600),height:f(400),rotateEnabled:f(!1),colorValue:f("#000000"),rainbowEnabled:f(!1),wordCount:f(100)},e=t=>{o.isLoading=t},n=t=>(console.log("[DEBUG] 开始读取文件:",t.name,t.size),new Promise((r,a)=>{const i=new FileReader;i.onload=h=>r(h.target.result),i.onerror=()=>a(new Error("文件读取失败")),i.readAsText(t,"UTF-8")})),X=t=>(console.log("[DEBUG] 原始文本:",t),t.toLowerCase().replace(/[^a-zA-Z\s]/g,"").split(/\s+/).filter(r=>r.length>3)),q=t=>{const r={};return t.forEach(a=>r[a]=(r[a]||0)+1),Object.entries(r).map(([a,i])=>({text:a,size:i}))},D=(t,r)=>`hsl(${t/r*360}, 100%, 50%)`,P=async t=>{t&&(await n(t),T($refs.wordCloudSvg))},Y=async()=>{e(!0);try{const t=await fetch("/data/llm.txt");o.rawText=await t.text(),alert("默认文件加载完成！"),console.log("[LOG] 默认文件读取完成，字数：",o.rawText.length)}catch(t){throw console.error("[ERROR] 读取默认文件失败:",t),t}finally{e(!1)}},T=()=>{const t=S.value;if(!t){console.error("SVG element not found!");return}if(!o.rawText||o.rawText.trim().length===0)throw new Error("请先加载有效的文本文件（内容不能为空）");e(!0);const r=X(o.rawText);console.log("[LOG] 分词完成，总词数：",r.length);let a=q(r).sort((b,C)=>C.size-b.size).slice(0,o.wordCount.value);console.log("[DEBUG] Top 10 词频：",a.slice(0,10));const i=a[0].size,h=a[a.length-1].size;let d=Math.min(60,Math.floor(Math.min(o.width.value,o.height.value)/10)),m=Math.max(8,Math.floor(d/3)),V=0;const W=(b,C)=>{const j=K().domain([h,i]).range([b,C]),Z=a.map(s=>({text:s.text,size:j(s.size),customXY:null}));console.log(`[DEBUG] 尝试绘制 fontSize 范围：${b} ~ ${C}`),x(t).html("").attr("width",o.width.value).attr("height",o.height.value),Q().size([o.width.value,o.height.value]).words(Z).spiral("archimedean").padding(1).rotate(()=>{if(!o.rotateEnabled.value)return 0;const s=Math.random();return s<.3?0:s<.5?90:Math.floor(Math.random()*61)-30}).font("Impact").fontSize(s=>s.size).on("end",s=>{if(console.log("[DEBUG] 实际绘制词数量：",s.length),s.length===0&&V<5){V++,d=Math.floor(d*.85),m=Math.floor(m*.85),console.warn(`[WARN] 第 ${V} 次重试，字体太大？缩小后重试...`),W(m,d);return}x(t).append("g").attr("transform",`translate(${o.width.value/2},${o.height.value/2})`).selectAll("text").data(s).enter().append("text").style("font-size",g=>`${g.size}px`).style("fill",(g,k)=>o.rainbowEnabled.value?D(k,s.length):o.colorValue.value).style("font-family","Impact").attr("text-anchor","middle").attr("transform",g=>{const[k,H]=g.customXY||[g.x,g.y];return`translate(${k},${H}) rotate(${g.rotate})`}).on("mouseover",function(){x(this).style("fill",_(o.colorValue.value).darker(1))}).on("mouseout",function(){x(this).style("fill",o.rainbowEnabled.value?D(Array.from(this.parentNode.children).indexOf(this),s.length):o.colorValue.value)}).text(g=>g.text),e(!1),console.log("[LOG] 词云绘制完成，共绘制词数：",s.length),alert("词云图生成完成！")}).start()};W(m,d)};return{...o,handleFileUpload:P,loadDefaultFile:Y,generateWordCloud:T,downloadWordCloud:t=>{if(!t||t.children.length===0)throw new Error("请先生成词云图");return e(!0),new Promise(r=>{const a=document.createElement("canvas"),i=a.getContext("2d");a.width=t.width.baseVal.value,a.height=t.height.baseVal.value;const h=new XMLSerializer().serializeToString(t),d=new Image;d.onload=function(){i.drawImage(d,0,0);const m=document.createElement("a");m.download="wordcloud.png",m.href=a.toDataURL("image/png"),m.click(),e(!1),r()},d.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(h)))})},randomizeSettings:()=>{const t=["#BFECFF","#CDC1FF","#FFCCEA","#B1AFFF"],r=[400,600,800,1e3],a=[100,200,300,400];o.colorValue.value=t[Math.floor(Math.random()*t.length)],o.rotateEnabled.value=Math.random()>.5,o.width.value=r[Math.floor(Math.random()*r.length)],o.height.value=r[Math.floor(Math.random()*r.length)],o.wordCount.value=a[Math.floor(Math.random()*a.length)],o.rainbowEnabled.value=Math.random()>.5,console.log("[LOG] 随机参数设置完成")}}},{width:c,height:y,colorValue:M,rotateEnabled:z,rainbowEnabled:E,wordCount:F,loadDefaultFile:R,generateWordCloud:$,randomizeSettings:O,downloadWordCloud:I,handleFileUpload:N}=A();return(o,e)=>(B(),G("div",null,[e[22]||(e[22]=l("h4",null,"Word Cloud Generator",-1)),l("div",te,[l("label",null,[e[13]||(e[13]=v("选择本地文件: ")),l("input",{type:"file",onChange:e[0]||(e[0]=n=>u(N)(n.target.files[0])),accept:".txt"},null,32)]),l("button",{onClick:e[1]||(e[1]=n=>u(R)())},"使用默认文件"),l("button",{onClick:e[2]||(e[2]=n=>u($)())},"点击生成词云图"),l("button",{onClick:e[3]||(e[3]=n=>u(O)())},"随机设置展示样式"),l("button",{onClick:e[4]||(e[4]=n=>u(I)())},"下载词云图"),e[21]||(e[21]=l("div",{class:"break-after"},null,-1)),l("label",null,[e[14]||(e[14]=v("颜色: ")),p(l("input",{type:"color","onUpdate:modelValue":e[5]||(e[5]=n=>w(M)?M.value=n:null)},null,512),[[U,u(M)]])]),l("label",null,[e[15]||(e[15]=v("旋转: ")),p(l("input",{type:"checkbox","onUpdate:modelValue":e[6]||(e[6]=n=>w(z)?z.value=n:null)},null,512),[[L,u(z)]])]),l("label",null,[e[16]||(e[16]=v("彩虹色: ")),p(l("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=n=>w(E)?E.value=n:null)},null,512),[[L,u(E)]])]),l("label",null,[e[18]||(e[18]=v("展示数量: ")),p(l("select",{"onUpdate:modelValue":e[8]||(e[8]=n=>w(F)?F.value=n:null)},e[17]||(e[17]=[l("option",{value:"100"},"100",-1),l("option",{value:"200"},"200",-1),l("option",{value:"300"},"300",-1),l("option",{value:"400"},"400",-1)]),512),[[J,u(F)]])]),l("label",null,[e[19]||(e[19]=v("画布大小: ")),p(l("input",{type:"number","onUpdate:modelValue":e[9]||(e[9]=n=>w(c)?c.value=n:null),onChange:e[10]||(e[10]=n=>u($)(o.$refs.wordCloudSvg))},null,544),[[U,u(c),void 0,{number:!0}]]),e[20]||(e[20]=v(" x ")),p(l("input",{type:"number","onUpdate:modelValue":e[11]||(e[11]=n=>w(y)?y.value=n:null),onChange:e[12]||(e[12]=n=>u($)(o.$refs.wordCloudSvg))},null,544),[[U,u(y),void 0,{number:!0}]])])]),e[23]||(e[23]=l("div",{id:"loading"},"正在加载中...",-1)),(B(),G("svg",{ref_key:"wordCloudSvg",ref:S,id:"wordCloud"},null,512))]))}},ie=ee(oe,[["__scopeId","data-v-b7cee95b"]]);export{ie as default};
